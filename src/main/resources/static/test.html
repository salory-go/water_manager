<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map with Vue.js</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 引入Leaflet的CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- 引入Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>
<body>
<div id="app">
    <div id="map" style="width: 100%; height: 600px;"></div>
</div>

<!-- 引入Leaflet的JavaScript -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            map: null,
            markers: []
        },
        mounted() {
            this.initMap();
        },
        methods: {
            initMap() {
                // 初始化地图，并设置中心点和缩放级别
                this.map = L.map('map').setView([30, 120], 8);

                // 添加OpenStreetMap的图层
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(this.map);

                fetch('http://localhost:8080/CZ')
                    .then(response => response.json())
                    .then(data => {
                        data.forEach((sdata, i) => {
                            this.markers.push({
                                lat: sdata.w,
                                lng: sdata.e,
                                message: sdata.name,
                                code: sdata.code
                            })
                        });
                        console.log(this.markers[0].lat);
                        this.markers.forEach(marker => {
                            let mark = L.marker([marker.lat, marker.lng]).addTo(this.map);
                            mark.bindPopup(marker.message).openPopup();
                            let circle = L.circle([marker.lat, marker.lng], {
                                color: 'red',
                                fillColor: '#f03',
                                fillOpacity: 0.5,
                                radius: 20
                            }).addTo(this.map);
                        });
                    })
                    .catch(error => console.error('Error fetching data:', error));
            },
        }
    });
</script>
</body>
</html>
